controller_project/                           # ğŸŒ Root of the Autonomous Investigation Framework
â”‚
â”œâ”€â”€ controller/                               # ğŸš€ Main orchestration logic and LLM coordination
â”‚   â”‚
â”‚   â”œâ”€â”€ main_controller.py                    # ğŸ§  Central orchestrator; manages recursive investigation loop,
â”‚   â”‚                                         # calls all agents, logs transactions, and writes reports.
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                               # ğŸ¤– Specialized functional + LLM-driven agents
â”‚   â”‚   â”œâ”€â”€ triage_agent.py                   # ğŸ©º LLM-based triage â€” extracts entities from alerts,
â”‚   â”‚   â”‚                                     # generates initial hypotheses and data requests.
â”‚   â”‚   â”œâ”€â”€ investigation_agent.py            # ğŸ” LLM reasoning engine â€” analyzes evidence, updates hypotheses,
â”‚   â”‚   â”‚                                     # and decides if further data is needed or if verdict can be made.
â”‚   â”‚   â”œâ”€â”€ enrichment_agent.py               # ğŸŒ Entity enrichment â€” looks up IPs/domains/users/file hashes
â”‚   â”‚   â”‚                                     # against local intel or external reputation sources.
â”‚   â”‚   â”œâ”€â”€ data_fetcher_agent.py             # ğŸ“¡ Collects logs and telemetry from configured sources (mocked here).
â”‚   â”‚   â”‚                                     # Replace with connectors to SIEM, EDR, firewall, DNS, or AD APIs.
â”‚   â”‚   â”œâ”€â”€ reporter_agent.py                 # ğŸ§¾ Generates structured final report with classification,
â”‚   â”‚   â”‚                                     # reasoning, timeline, and confidence level.
â”‚   â”‚   â””â”€â”€ __init__.py                       # Marks directory as a Python package.
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                                # ğŸ§° Utility and helper modules used by controller and agents
â”‚   â”‚   â”œâ”€â”€ file_utils.py                     # ğŸ“ Save/load JSON files, ensure directories exist.
â”‚   â”‚   â”œâ”€â”€ logger.py                         # ğŸªµ Centralized logging utility; writes to debug_logs.
â”‚   â”‚   â”œâ”€â”€ field_filter.py                   # ğŸ§¹ Filters logs to retain only relevant fields based on fieldmapping.json.
â”‚   â”‚   â”œâ”€â”€ summarizer.py                     # ğŸ§  Converts multiple raw logs into concise semantic summaries.
â”‚   â”‚   â”œâ”€â”€ malicious_matcher.py              # âš”ï¸ Scans parsed logs for known suspicious behaviors using
â”‚   â”‚   â”‚                                     # rules from /behaviors/ (single, aggregation, or sequence types).
â”‚   â”‚   â”œâ”€â”€ data_reduction_pipeline.py        # ğŸ§® NEW: Reduces large log volumes before LLM analysis.
â”‚   â”‚   â”‚                                     # - Filters fields
â”‚   â”‚   â”‚                                     # - Matches behaviors
â”‚   â”‚   â”‚                                     # - Aggregates repetitive logs
â”‚   â”‚   â”‚                                     # - Generates compact summaries including critical fields
â”‚   â”‚   â”‚                                     # - Outputs top-N summaries for LLM investigation loop.
â”‚   â”‚   â””â”€â”€ __init__.py                       # Marks directory as a Python package.
â”‚   â”‚
â”‚   â””â”€â”€ __init__.py                           # Marks /controller as a package root.
â”‚
â”‚
â”œâ”€â”€ configs/                                  # âš™ï¸ Configuration files for controller, LLM schema, and sources
â”‚   â”œâ”€â”€ controller_config.json                # ğŸ›ï¸ Global config â€” thresholds, timeouts, and max iterations.
â”‚   â”œâ”€â”€ fieldmapping.json                     # ğŸ§© Defines allowed field names for each log source
â”‚   â”‚                                         # (used by field_filter.py and summarizer).
â”‚   â”œâ”€â”€ logsources.json                       # ğŸ“š Lists supported log sources and vendors with descriptions.
â”‚   â”œâ”€â”€ output_schema.json                    # ğŸ§¾ Defines expected structure of LLM final report outputs.
â”‚   â””â”€â”€ prompt_template.json                  # ğŸ’¬ (Optional) Store system + user prompt templates for agents.
â”‚
â”‚
â”œâ”€â”€ behaviors/                                # ğŸ” Behavior detection rule library
â”‚   â”œâ”€â”€ endpoint_single.json                  # âš¡ Detects individual suspicious endpoint events
â”‚   â”‚                                         # (e.g., encoded PowerShell, Mimikatz, unsigned binaries).
â”‚   â”œâ”€â”€ endpoint_aggregation.json             # ğŸ“Š Detects aggregated suspicious patterns (e.g., high unsigned executions).
â”‚   â”œâ”€â”€ endpoint_sequence.json                # â›“ï¸ Detects multi-step sequences (e.g., registry change â†’ PowerShell â†’ injection).
â”‚   â”œâ”€â”€ firewall_behaviour.json               # ğŸŒ Network-based detections (exfiltration, C2, port scanning).
â”‚   â”œâ”€â”€ dns_behaviour.json                    # ğŸ§­ Detects suspicious DNS patterns (DGAs, tunneling, etc.).
â”‚   â”œâ”€â”€ ad_behaviour.json                     # ğŸ”‘ Detects suspicious authentication and privilege escalation attempts.
â”‚   â””â”€â”€ README.md                             # ğŸ“˜ Describes the behavior rule schema and authoring guidelines.
â”‚
â”‚
â”œâ”€â”€ data/                                     # ğŸ§¾ Runtime data storage and mock datasets
â”‚   â”‚
â”‚   â”œâ”€â”€ incoming_alerts/                      # ğŸš¨ Alerts ingested into the investigation loop.
â”‚   â”‚   â”œâ”€â”€ alert_data_exfil.json             # Example alert: large outbound data transfer.
â”‚   â”‚   â”œâ”€â”€ alert_powershell.json             # Example alert: encoded PowerShell execution.
â”‚   â”‚
â”‚   â”œâ”€â”€ mock_logs/                            # ğŸ§  Mock data sources (replace with real SIEM/EDR data feeds)
â”‚   â”‚   â”œâ”€â”€ endpoint_logs.csv                 # Endpoint process/registry logs (aligned with fieldmapping.json)
â”‚   â”‚   â”œâ”€â”€ firewall_logs.csv                 # Network flow logs for exfiltration scenarios.
â”‚   â”‚   â”œâ”€â”€ dns_logs.csv                      # DNS logs showing benign & suspicious resolutions.
â”‚   â”‚   â”œâ”€â”€ ad_logs.csv                       # Active Directory login events (used for lateral movement analysis).
â”‚   â”‚
â”‚   â”œâ”€â”€ evidence_store/                       # ğŸ“‚ Stores normalized evidence collected per case.
â”‚   â”‚   â””â”€â”€ CASE-XXXXXX/                      # Each case folder holds evidence JSONs (e.g., EV-xxxx.json).
â”‚   â”‚
â”‚   â”œâ”€â”€ case_reports/                         # ğŸ§¾ Investigation reports generated per case.
â”‚   â”‚   â””â”€â”€ CASE-XXXXXX/                      # Each case folder includes:
â”‚   â”‚       â”œâ”€â”€ final_report.json             # Machine-readable structured report.
â”‚   â”‚       â”œâ”€â”€ final_report.txt              # Analyst-readable summary.
â”‚   â”‚       â”œâ”€â”€ report_metadata.json          # Metadata (case ID, timestamps, final reason).
â”‚   â”‚
â”‚   â””â”€â”€ test_data/                            # ğŸ§ª Optional folder for regression or stress test datasets.
â”‚
â”‚
â”œâ”€â”€ debug_logs/                               # ğŸªµ Logs controller runtime behavior and errors.
â”‚   â”œâ”€â”€ controller_errors.log                 # Error trace log for controller exceptions.
â”‚   â””â”€â”€ investigation_steps.log               # (Optional) Detailed per-iteration debugging output.
â”‚
â”‚
â”œâ”€â”€ llm_transactions/                         # ğŸ’¬ Full trace of all LLM interactions (auditable)
â”‚   â””â”€â”€ CASE-XXXXXX/                          # Per-case folder containing:
â”‚       â”œâ”€â”€ triage_iter1_request.json         # Input prompt sent to triage agent.
â”‚       â”œâ”€â”€ triage_iter1_response.json        # LLMâ€™s structured JSON output.
â”‚       â”œâ”€â”€ investigation_iterX_request.json  # Input for investigation agent.
â”‚       â”œâ”€â”€ investigation_iterX_response.json # Investigation agent output.
â”‚       â”œâ”€â”€ enrichment_<timestamp>.json       # Entity enrichment logs.
â”‚       â””â”€â”€ reporter_request.json             # Final reporting I/O for audit trail.
â”‚
â”‚
â”œâ”€â”€ tests/                                    # ğŸ§ª Unit and integration testing
â”‚   â”œâ”€â”€ sample_alerts/                        # Sample alert scenarios for quick verification.
â”‚   â”œâ”€â”€ mock_behaviors/                       # Example behavior JSONs for offline tests.
â”‚   â””â”€â”€ run_tests.py                          # Runs automated validation of investigation pipeline.
â”‚
â”‚
â”œâ”€â”€ README_updates.txt                        # ğŸ“ Guidance on environment setup (.env), config tuning, and behavior updates.
â”œâ”€â”€ .env                                      # ğŸ” Environment file for Azure/OpenAI keys and LLM settings (create manually).
â”œâ”€â”€ requirements.txt                          # ğŸ“¦ Python dependencies (e.g., python-dotenv, openai, pandas, requests).
â””â”€â”€ README.md                                 # ğŸ“˜ Project documentation and user guide.


ğŸ”„ Investigation Flow Summary
==================================================
1ï¸âƒ£ Alert Ingestion     â†’ alert_data_exfil.json loaded
2ï¸âƒ£ Triage Agent         â†’ Extracts entities + initial hypotheses
3ï¸âƒ£ Data Fetcher         â†’ Retrieves relevant logs
4ï¸âƒ£ Data Reduction       â†’ Filters + aggregates + summarizes large datasets
5ï¸âƒ£ Enrichment Agent     â†’ Adds reputation & contextual info
6ï¸âƒ£ Investigation Agent  â†’ Refines hypotheses, classifies threat
7ï¸âƒ£ Reporter Agent       â†’ Generates structured report
8ï¸âƒ£ Controller Output    â†’ final_report.json + metadata + audit trail

